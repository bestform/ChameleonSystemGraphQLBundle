<?php

// This file is autogenerated. Do not edit it!

namespace ChameleonSystem\GraphQLBundle\Resolver;

use ChameleonSystem\CoreBundle\ServiceLocator;
use Doctrine\DBAL\Connection;
use GraphQL\Type\Definition\ResolveInfo;
use Overblog\GraphQLBundle\Definition\Argument;
use Overblog\GraphQLBundle\Resolver\ResolverMap;

final class ##CLASSNAME## extends ResolverMap
{
    private function getAll()
    {
        $query = "SELECT id FROM ##TYPENAME##";
        $db = ServiceLocator::get('database_connection');
        $all = $db->fetchAll($query);

        return $all;
    }

    private function getField(string $id, string $fieldName)
    {
        static $cache = [];
        if (!array_key_exists($id, $cache)) {
            $query = 'SELECT * FROM ##TYPENAME##';
            /** @var Connection $db */
            $db = ServiceLocator::get('database_connection');
            $res = $db->fetchAll($query, ['id' => $id]);
            foreach ($res as $result) {
                $cache[$result['id']] = $result;
            }
        }

        return $cache[$id][$fieldName];
    }

    protected function map()
    {
        return [
            '##RootQueryName##' => [
                self::RESOLVE_FIELD => static function ($value, Argument $args, \ArrayObject $context, ResolveInfo $info) {
                    if ('##QUERYNAME##' === $info->fieldName) {
                        return $this->getAll();
                    }

                    return null;
                }
            ],
            '##TYPENAME##' => [
                self::RESOLVE_FIELD => static function($value, Argument $args, \ArrayObject $context, ResolveInfo $info) {
                    $fieldContent = $this->getField($value['id'], $info->fieldName);
                    if(null !== $fieldContent) {
                        return $fieldContent;
                    }

                    return $value[$info->fieldName];
                }
            ],
        ];
    }
}
